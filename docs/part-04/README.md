# Install Harbor

![Harbor logo](https://raw.githubusercontent.com/cncf/artwork/c33a8386bce4eabc36e1d4972e0996db4630037b/projects/harbor/horizontal/color/harbor-horizontal-color.svg?sanitize=true
"Harbor logo")

## Install Harbor using Helm

Lab architecture:

![Lab architecture](https://raw.githubusercontent.com/ruzickap/k8s-harbor-presentation/master/images/harbor_demo_architecture_diagram.svg?sanitize=true
"Lab architecture")

Label Harbor namespace and copy there the secret with certificates signed by
Let's Encrypt certificate:

```bash
kubectl get namespace harbor-system &> /dev/null || kubectl create namespace harbor-system
kubectl label namespace harbor-system app=kubed
```

Check if the certificate generated by cert-manager in `cert-manager` namespace
was successfully copied to `harbor-system` namespace:

```bash
kubectl get secrets ingress-cert-${LETSENCRYPT_ENVIRONMENT} -n harbor-system -o json | jq ".metadata | .annotations, .labels"
```

Output:

```json
```

Add Harbor Helm repository:

```bash
helm repo add harbor https://helm.goharbor.io
```

Install Harbor using Helm:

```bash
helm ls | grep harbor || \
helm install --wait --name harbor --namespace harbor-system harbor/harbor --version v1.1.1 \
  --set database.type=external \
  --set database.external.host=pgsql.${MY_DOMAIN} \
  --set database.external.username=harbor_user \
  --set database.external.password=harbor_user_password \
  --set database.external.coreDatabase=harbor-registry \
  --set database.external.clairDatabase=harbor-clair \
  --set database.external.notaryServerDatabase=harbor-notary_server \
  --set database.external.notarySignerDatabase=harbor-notary_signer \
  --set expose.ingress.hosts.core=harbor.${MY_DOMAIN} \
  --set expose.ingress.hosts.notary=notary.${MY_DOMAIN} \
  --set expose.tls.secretName=ingress-cert-${LETSENCRYPT_ENVIRONMENT} \
  --set persistence.enabled=true \
  --set externalURL=https://harbor.${MY_DOMAIN} \
  --set harborAdminPassword=admin \
  --set persistence.resourcePolicy=delete \
  --set persistence.persistentVolumeClaim.registry.size=1Gi \
  --set persistence.persistentVolumeClaim.chartmuseum.size=1Gi
```

Harbor architecture:

![Harbor Architecture](https://raw.githubusercontent.com/goharbor/harbor/5d31dd5b57d83f300907744aabf13ca60aac19b3/docs/img/harbor-arch.png
"Harbor Architecture")

Check how the Harbor Ingress looks like:

```bash
kubectl describe ingresses -n harbor-system harbor-harbor-ingress
```

Output:

```text
```

Open the [https://harbor.mylabs.dev](https://harbor.mylabs.dev):

![Harbor login page](./harbor_login_page.png "Harbor login page")

Log in:

* User: `admin`
* Password: `admin`

You should see the Web UI:

![Harbor](./harbor_projects.png "Harbor")
